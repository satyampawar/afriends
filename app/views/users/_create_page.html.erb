
<div class="col-xs-12 col-sm-12" >      
  <div class="panel panel-primary">
    <div class="panel-heading">
      <h3 class="panel-title" style="color: pink;">Create Your Page</h3>
      <span class="pull-right">
        <!-- Tabs -->
        <ul class="nav panel-tabs">
          <li class="active"><a href="#tab1" data-toggle="tab">Social</a></li>
          <li><a href="#tab2" data-toggle="tab">Institute</a></li>
          <li><a href="#tab3" data-toggle="tab">Movie</a></li>
          <li><a href="#tab4" data-toggle="tab">Country</a></li>
        </ul>
      </span>
    </div>
    <div class="panel-body">
      <%= form_tag user_pages_path, multipart: true do%>
        <div class="tab-content">
          <!-- <input id="address12" type="textbox" value="Sydney, NSW"> -->
          <!-- <input type="button" value="Get Addrss" onclick="codeAddress()"> -->
          <div class="tab-pane active" id="tab1">
            <div class="form-group">
              <%= text_field_tag :name, nil, :placeholder => 'Name', :class => 'form-control' %>
            </div>
            <div class="form-group">
              <%= text_area_tag :rules, nil, :placeholder => 'Rules', :class => 'form-control' %>
            </div>
            <div class="form-group">
              <%= submit_tag "Create Social Page", :class => 'btn btn-primary' %>
            </div>
          </div>
          <div class="tab-pane" id="tab2">
            <div class="form-group">
              <%= text_field_tag :name, nil, :placeholder => 'Name', :class => 'form-control' %>
            </div>

            <div class="form-group">
              <div class="col-md-8" style="margin-left: -15px;">
                <%= text_field_tag :address, nil, :placeholder => 'Search Your Address and point it on Map', :class => 'form-control' %>
                <%= hidden_field_tag :formatted_address, nil %>
                <%= hidden_field_tag :lats, nil %>
                <%= hidden_field_tag :longs, nil %>
                <%= hidden_field_tag :page_type, nil %>
              </div>
              <div class="col-md-4">
                <%= link_to "Find", "javascript:void(0)", :onclick => 'codeAddress()', :class => 'btn btn-primary' %>
              </div>
            </div>

            <div class="clearfix"></div>

            <div class="col-md-11">
              <div class="map-div">
                <div id="map_canvas" style="height:auto;margin-top:30px; position: inherit !important; width: auto !important;"></div>
              </div>
            </div>
            <div class="col-md-1"></div>

            <div class="form-group">
              <div class="col-md-12" style="margin-left: -15px; margin-top:20px; position: inherit !important;">
                Upload Institute Picture <%= file_field_tag :picture %>
              </div>
              <div class="clearfix"></div>
            </div>
            <div class="form-group">
              <%= submit_tag "Create College Page", :class => 'btn btn-primary' %>
            </div>
          </div>

          <div class="tab-pane" id="tab3">
            <div class="form-group">
              <div class="col-md-8" style="margin-left: -15px;">
                <%= hidden_field_tag :set_movie_id, nil%>
                <%= hidden_field_tag :set_title, nil %>
                <%= hidden_field_tag :set_plot_summary, nil %>
                <%= hidden_field_tag :set_poster_url, nil %>
                <%= hidden_field_tag :set_video_url, nil %>
                <%= hidden_field_tag :set_rating, nil %>
                <%= hidden_field_tag :set_director, nil %>
                <%= hidden_field_tag :set_year, nil %>
                <%= hidden_field_tag :set_release_date, nil %>
                <%= text_field_tag :movie_name, nil, :placeholder => 'Movie Name', :class => 'form-control' %>
              </div>
              <div class="col-md-4">
                <%= link_to "Find", "javascript:void(0)", :onclick => 'findMovies()', :class => 'btn btn-primary' %>
              </div>
            </div>
            <div class="clearfix"></div>

            <div class="form-group">
              <div class="col-md-12" style="margin-top:20px;">
                <table id="datatable" class="table table-striped table-bordered table-hover " cellspacing="0">
                  <thead>
                  <tr>
                    <th></th>
                    <th>Title</th>
                    <th>Rating</th>
                    <th></th>
                  </tr>
                  </thead>
                </table>
              </div>
            </div>
            <div class="form-group">
              <%= submit_tag "Create Movie Page", id: "movie_submit",:class => 'btn btn-primary' %>
            </div>
          </div>
          <div class="tab-pane" id="tab4">
            
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
<%= render 'google_map'%>

<style type="text/css">
  .panel-tabs {
    position: relative;
    bottom: 30px;
    clear:both;
    border-bottom: 1px solid transparent;
}

.panel-tabs > li {
    float: left;
    margin-bottom: -1px;
}

.panel-tabs > li > a {
    margin-right: 2px;
    margin-top: 4px;
    line-height: .85;
    border: 1px solid transparent;
    border-radius: 4px 4px 0 0;
    color: #ffffff;
}
.map-div {
    height: 200px;
    margin-top: 1%;
    position: unset;
}
.map-div div{
    max-height: 200px !important;  
}

#map_canvas {
  height: 100%;
}

@media print {
  html,
  body {
    height: auto;
  }
}

#map_canvas {
    position: inherit !important;
    height: 650px;
}

.panel-tabs > li > a:hover {
    border-color: transparent;
    color: #ffffff;
    background-color: transparent;
}

.panel-tabs > li.active > a,
.panel-tabs > li.active > a:hover,
.panel-tabs > li.active > a:focus {
    color: #fff;
    cursor: default;
    -webkit-border-radius: 2px;
    -moz-border-radius: 2px;
    border-radius: 2px;
    background-color: rgba(255,255,255, .23);
    border-bottom-color: transparent;
}
.panel-body{
  position: relative;
  height: auto;
}






/*#loader {
  position: fixed;
  left: 50%;
  top: 50%;
  z-index: 1;
  margin: -75px 0 0 -75px;
  border: 16px solid transparent;
  border-radius: 50%;
  border-top: 16px solid white;
  border-bottom: 16px solid white;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 1s linear infinite;
  animation: spin 1s linear infinite;
}*/



#loader {
  position: relative;
  left: 40%;
  top: 50%;
  margin-left: 0px;
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid teal;
  border-bottom: 16px solid teal;
  width: 100px;
  height: 110px;
  -webkit-animation: spin 2s linear infinite;
  animation: spin 2s linear infinite;
}

@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Add animation to "page content" */
.animate-bottom {
  position: relative;
  -webkit-animation-name: animatebottom;
  -webkit-animation-duration: 1s;
  animation-name: animatebottom;
  animation-duration: 1s
}

@-webkit-keyframes animatebottom {
  from { bottom:-100px; opacity:0 } 
  to { bottom:0px; opacity:1 }
}

@keyframes animatebottom { 
  from{ bottom:-100px; opacity:0 } 
  to{ bottom:0; opacity:1 }
}

</style>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAJho-K64WJTAuK9qZFV2-aqvUCDx5K8uI"></script>

<script type="text/javascript">

function setValue(id){
  var plot_summary = $("#psm_"+id).val()
  var image_url = $("#img_"+id).val()
  var video_url = $("#video_"+id).val()
  var title = $("#title_"+id).val()
  var rating = $("#rating_"+id).val()
  var director = $("#director_"+id).val()
  var year = $("#year_"+id).val()
  var votes = $("#votes_"+id).val()
  var release_date = $("#release_date_"+id).val()
  $("#set_movie_id").val(id)
  $("#set_plot_summary").val(plot_summary)
  $("#set_poster_url").val(image_url)
  $("#set_video_url").val(video_url)
  $("#set_title").val(title)
  $("#set_rating").val(rating)
  $("#set_director").val(director)
  $("#set_year").val(year)
  $("#set_votes").val(votes)
  $("#set_release_date").val(release_date)
  $("#page_type").val("movi")
}


  var geocoder;
  var map;
  var marker;
  var infowindow = new google.maps.InfoWindow({
    size: new google.maps.Size(150, 50)
  });

  function geocodePosition(pos) {
    geocoder.geocode({
      latLng: pos
    }, function(responses) {
      if (responses && responses.length > 0) {
        updateMarkerAddress(responses[0].formatted_address);
      } else {
        updateMarkerAddress('Cannot determine address at this location.');
      }
    });
  }

  function initialize() {
    geocoder = new google.maps.Geocoder();
    var latlng = new google.maps.LatLng(-34.397, 150.644);
    var mapOptions = {
      zoom: 8,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
    google.maps.event.addListener(map, 'click', function() {
      infowindow.close();
    });
  }

  function geocodePosition(pos) {
    geocoder.geocode({
      latLng: pos
    }, function(responses) {
      if (responses && responses.length > 0) {
        marker.formatted_address = responses[0].formatted_address;
        $("#lats").val(marker["position"].toUrlValue().split(',')[0]);
        $("#longs").val(marker["position"].toUrlValue().split(',')[1]);
        $("#formatted_address").val(responses[0].formatted_address)
      } else {
        marker.formatted_address = 'Cannot determine address at this location.';
      }
      infowindow.setContent(marker.formatted_address + "<br>coordinates: " + marker.getPosition().toUrlValue(6));
      infowindow.open(map, marker);
    });
  }

  function codeAddress() {
    var address = document.getElementById('address').value;
    geocoder.geocode({
      'address': address
    }, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
        if (marker) {
          marker.setMap(null);
          if (infowindow) infowindow.close();
        }
        marker = new google.maps.Marker({
          map: map,
          draggable: true,
          position: results[0].geometry.location
        });
        google.maps.event.addListener(marker, 'dragend', function() {
          geocodePosition(marker.getPosition());
        });
        google.maps.event.addListener(marker, 'click', function() {
          if (marker.formatted_address) {
            infowindow.setContent(marker.formatted_address + "<br>coordinates: " + marker.getPosition().toUrlValue(6));
          } else {
            infowindow.setContent(address + "<br>coordinates: " + marker.getPosition().toUrlValue(6));
          }
          infowindow.open(map, marker);
        });
        google.maps.event.trigger(marker, 'click');
        $("#lats").val(marker["position"].toUrlValue().split(',')[0]);
        $("#longs").val(marker["position"].toUrlValue().split(',')[1]);
        $("#page_type").val("inst");
        $("#formatted_address").val($("#address").val())
      } else {
        alert('Geocode was not successful for the following reason: ' + status);
      }
    });
  }

  google.maps.event.addDomListener(window, "load", initialize);


  function findMovies(){
    $.ajax
      ({
        method : "get",
        data: {movie_name: $("#movie_name").val()},
        url :  "/search_movies",

        beforeSend: function(){
          // $('body').css({ "opacity": "0.1","background-color" : "#999"})
   
          $('#datatable').hide()
          $('#datatable').parent().prepend("<div id='loader'></div>")
          $("#movie_submit").prop('disabled', true);
          // Handle the beforeSend event
        },
        complete: function(){
          $('#loader').remove()
          // $('body').css({ "opacity": "5","background": "none"})
          $('#datatable').show()
          $("#movie_submit").prop('disabled', false);
          
          // Handle the complete event
        }
      }).always(function(data) {
        if (data != null){
          $("#movie_name").val("")
          $("#datatable").dataTable().fnDestroy();
          $('#datatable').dataTable({
            "scrollX": true,
            "bDestroy":true,
            data: data,
            "fnDrawCallback": function(oSettings) {
            $(".radio-btn").prop('checked', false);
            }
          });
        }
        else
        {
          alert("Not Found");
        }
      });
  }


$(document).ready(function(){
  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    $(".tab-content .form-control").val(null)
  });
});
</script>

<!-- <script type="text/javascript"> function initialize() { //set initial settings for the map here
 var mapOptions = { 
  //set center of map as center for the contiguous US 
  center: new google.maps.LatLng(39.828, -98.5795), zoom: 4, mapTypeId: google.maps.MapTypeId.HYBRID };
   //load the map
    var map = new google.maps.Map(document.getElementById("map"), mapOptions); //This runs when the user clicks on the map 
    google.maps.event.addListener(map, 'click', function(event) { //initialize geocoder 
    var geocoder = new google.maps.Geocoder() 
    //load coordinates into the user form 
    main_form.latitude.value = event.latLng.lat(); 
    main_form.longitude.value = event.latLng.lng(); 
    //prepare latitude and longitude
     var latlng = new google.maps.LatLng(event.latLng.lat(), event.latLng.lng()); 
    //get address info such as city and state from lat and long 
      geocoder.geocode({'latLng': latlng}, function(results, status)
     { if (status == google.maps.GeocoderStatus.OK) { 
      //break down the three dimensional array into simpler arrays
       for (i = 0 ; i < results.length ; ++i) { var super_var1 = results[i].address_components; for (j = 0 ; j < super_var1.length ; ++j) { var super_var2 = super_var1[j].types; for (k = 0 ; k < super_var2.length ; ++k) { 
        //find city 
        if (super_var2[k] == "locality") { 
          //put the city name in the form
           main_form.city.value = super_var1[j].long_name; }
            //find county 
            if (super_var2[k] == "administrative_area_level_2")
             {
              //put the county name in the form 
              main_form.county.value = super_var1[j].long_name; }
               //find State
                if (super_var2[k] == "administrative_area_level_1") { 
                  //put the state abbreviation in the form 
                  main_form.state.value = super_var1[j].short_name; } } } } } }); }); } </script> -->






<!--
 id = Imdb::Search.new("Agneepath")
 uri = URI.parse(id.movies.first.url)
 http = Net::HTTP.new(uri.host, uri.port)
 request = Net::HTTP::Get.new(uri.request_uri)
 response = http.request(request)
 URI.extract(response.body).collect{|a| a.include?('.jpg') ? a.include?('amazon') ? a: nil : nil}.compact.first


 -->